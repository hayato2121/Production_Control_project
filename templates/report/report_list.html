{% extends 'base.html' %}

{% block content %}
<h1>所属部署:{{ user.department.name }}</h1>

<!--作業一覧-->
{% if reports %}
<ul>
    <table >
        <thead>
            <tr>
                <td>製品名</td>
                <td>製品コード</td>
                <td>業務内容</td>
                <td>作業者</td>
                <td>ロッド番号</td>
                <td>優良成形数</td>
                <td>不良成形数</td>
                
            </tr>
        </thead>
        <tbody>
            {% for report in reports %}
              <tr>
                <td>{{ report.product.name }}</td>
                <td>{{ report.product.code }}</td>
                <td>{{ report.business.name }}</td>
                <td>{{ report.user.username }}</td>
                <td>{{ report.lot_number }}</td>
                {% if report.good_product is not None %}
                <td>{{ report.good_product }}</td>
                <td>{{ report.bad_product }}</td>
                {% endif %}
                {% if report.good_product %}
                <td><button><a href="{% url 'daily_report:report_detail' pk=report.id %}">終了</a></button></td></td>
                {% else %}
                <td><button><a href="{% url 'daily_report:report_detail' pk=report.id %}">実行中</a></button></td>
                {% endif %}
                <!--あとでcssを使ってモーダルウィンドウにする-->
                <td><button><a href="{% url 'daily_report:report_delete' pk=report.id %}">削除</a></button></td>
                
              </tr>
            {% endfor %}
        </tbody>
    </table>
</ul>
{% endif %}

<p><a href="{% url 'daily_report:report_start' %}">作業をスタートする</a></p>

<script>
    /*
    var csrftoken = getCookie('csrftoken'); 
    function confirmDelete(reportId){
        if(confirm("この作業を削除していいですか")){
            $.ajax({
                url:"/report_delete/" + reportId + "/",
                method: "DELETE",
                headers: { "X-CSRFToken": csrftoken },
                success: function(response) {
                    if (response.success) {
                        alert("レポートが削除されました");
                        location.href = "{% url 'daily_report:report_list' %}";
                    } else {
                        alert('レポートの削除を中止しました');
                    }
                },
                error: function() {
                    alert("リクエストエラーが発生しました");
                }
            });
        }
    }
    */

    
</script>

{% endblock %}